export const colorPalettes = [
	// Blue Palettes
	{
		id: "light-blue",
		name: "Light Blue",
		primary: "#60a5fa",
		secondary: "#3b82f6",
		accent: "#93c5fd",
		background: "#f0f9ff",
		preview: ["#60a5fa", "#3b82f6", "#93c5fd", "#f0f9ff"],
	},
	{
		id: "default-blue",
		name: "Default Blue",
		primary: "#3b82f6",
		secondary: "#1e40af",
		accent: "#60a5fa",
		background: "#f8fafc",
		preview: ["#3b82f6", "#1e40af", "#60a5fa", "#f8fafc"],
	},
	{
		id: "dark-blue",
		name: "Dark Blue",
		primary: "#1e40af",
		secondary: "#1e3a8a",
		accent: "#3b82f6",
		background: "#f1f5f9",
		preview: ["#1e40af", "#1e3a8a", "#3b82f6", "#f1f5f9"],
	},
	{
		id: "navy-blue",
		name: "Navy Blue",
		primary: "#1e3a8a",
		secondary: "#1e293b",
		accent: "#1e40af",
		background: "#f8fafc",
		preview: ["#1e3a8a", "#1e293b", "#1e40af", "#f8fafc"],
	},
	{
		id: "sky-blue",
		name: "Sky Blue",
		primary: "#0ea5e9",
		secondary: "#0284c7",
		accent: "#38bdf8",
		background: "#f0f9ff",
		preview: ["#0ea5e9", "#0284c7", "#38bdf8", "#f0f9ff"],
	},
	{
		id: "steel-blue",
		name: "Steel Blue",
		primary: "#475569",
		secondary: "#334155",
		accent: "#64748b",
		background: "#f8fafc",
		preview: ["#475569", "#334155", "#64748b", "#f8fafc"],
	},

	// Red Palettes
	{
		id: "light-red",
		name: "Light Red",
		primary: "#f87171",
		secondary: "#ef4444",
		accent: "#fca5a5",
		background: "#fef2f2",
		preview: ["#f87171", "#ef4444", "#fca5a5", "#fef2f2"],
	},
	{
		id: "default-red",
		name: "Default Red",
		primary: "#ef4444",
		secondary: "#dc2626",
		accent: "#f87171",
		background: "#fef2f2",
		preview: ["#ef4444", "#dc2626", "#f87171", "#fef2f2"],
	},
	{
		id: "dark-red",
		name: "Dark Red",
		primary: "#dc2626",
		secondary: "#b91c1c",
		accent: "#ef4444",
		background: "#fef2f2",
		preview: ["#dc2626", "#b91c1c", "#ef4444", "#fef2f2"],
	},
	{
		id: "crimson-red",
		name: "Crimson Red",
		primary: "#b91c1c",
		secondary: "#991b1b",
		accent: "#dc2626",
		background: "#fef2f2",
		preview: ["#b91c1c", "#991b1b", "#dc2626", "#fef2f2"],
	},

	// Pink Palettes
	{
		id: "light-pink",
		name: "Light Pink",
		primary: "#f472b6",
		secondary: "#ec4899",
		accent: "#f9a8d4",
		background: "#fdf2f8",
		preview: ["#f472b6", "#ec4899", "#f9a8d4", "#fdf2f8"],
	},
	{
		id: "default-pink",
		name: "Default Pink",
		primary: "#ec4899",
		secondary: "#db2777",
		accent: "#f472b6",
		background: "#fdf2f8",
		preview: ["#ec4899", "#db2777", "#f472b6", "#fdf2f8"],
	},
	{
		id: "dark-pink",
		name: "Dark Pink",
		primary: "#db2777",
		secondary: "#be185d",
		accent: "#ec4899",
		background: "#fdf2f8",
		preview: ["#db2777", "#be185d", "#ec4899", "#fdf2f8"],
	},
	{
		id: "rose-pink",
		name: "Rose Pink",
		primary: "#e11d48",
		secondary: "#be123c",
		accent: "#f43f5e",
		background: "#fff1f2",
		preview: ["#e11d48", "#be123c", "#f43f5e", "#fff1f2"],
	},

	// Green Palettes
	{
		id: "light-green",
		name: "Light Green",
		primary: "#4ade80",
		secondary: "#22c55e",
		accent: "#86efac",
		background: "#f0fdf4",
		preview: ["#4ade80", "#22c55e", "#86efac", "#f0fdf4"],
	},
	{
		id: "default-green",
		name: "Default Green",
		primary: "#22c55e",
		secondary: "#16a34a",
		accent: "#4ade80",
		background: "#f0fdf4",
		preview: ["#22c55e", "#16a34a", "#4ade80", "#f0fdf4"],
	},
	{
		id: "dark-green",
		name: "Dark Green",
		primary: "#16a34a",
		secondary: "#15803d",
		accent: "#22c55e",
		background: "#f0fdf4",
		preview: ["#16a34a", "#15803d", "#22c55e", "#f0fdf4"],
	},
	{
		id: "emerald-green",
		name: "Emerald Green",
		primary: "#10b981",
		secondary: "#059669",
		accent: "#34d399",
		background: "#ecfdf5",
		preview: ["#10b981", "#059669", "#34d399", "#ecfdf5"],
	},
	{
		id: "forest-green",
		name: "Forest Green",
		primary: "#059669",
		secondary: "#047857",
		accent: "#10b981",
		background: "#ecfdf5",
		preview: ["#059669", "#047857", "#10b981", "#ecfdf5"],
	},
	{
		id: "teal-green",
		name: "Teal Green",
		primary: "#14b8a6",
		secondary: "#0d9488",
		accent: "#5eead4",
		background: "#f0fdfa",
		preview: ["#14b8a6", "#0d9488", "#5eead4", "#f0fdfa"],
	},
	// Green purple
	{
		id: "light-purple",
		name: "Light Purple",
		primary: "#c084fc",
		secondary: "#a855f7",
		accent: "#d8b4fe",
		background: "#f5f3ff",
		preview: ["#c084fc", "#a855f7", "#d8b4fe", "#f5f3ff"],
	},
	{
		id: "deep-purple",
		name: "Deep Purple",
		primary: "#7c3aed",
		secondary: "#5b21b6",
		accent: "#a78bfa",
		background: "#ede9fe",
		preview: ["#7c3aed", "#5b21b6", "#a78bfa", "#ede9fe"],
	},

	// Green orange
	{
		id: "light-orange",
		name: "Light Orange",
		primary: "#fb923c",
		secondary: "#f97316",
		accent: "#fdba74",
		background: "#fff7ed",
		preview: ["#fb923c", "#f97316", "#fdba74", "#fff7ed"],
	},
	{
		id: "burnt-orange",
		name: "Burnt Orange",
		primary: "#ea580c",
		secondary: "#c2410c",
		accent: "#f97316",
		background: "#ffedd5",
		preview: ["#ea580c", "#c2410c", "#f97316", "#ffedd5"],
	},
	// Yellow orange
	{
		id: "light-yellow",
		name: "Light Yellow",
		primary: "#facc15",
		secondary: "#eab308",
		accent: "#fde68a",
		background: "#fefce8",
		preview: ["#facc15", "#eab308", "#fde68a", "#fefce8"],
	},
	{
		id: "gold-yellow",
		name: "Gold Yellow",
		primary: "#eab308",
		secondary: "#ca8a04",
		accent: "#facc15",
		background: "#fefce8",
		preview: ["#eab308", "#ca8a04", "#facc15", "#fefce8"],
	},

	// Gray orange
	{
		id: "cool-gray",
		name: "Cool Gray",
		primary: "#9ca3af",
		secondary: "#6b7280",
		accent: "#d1d5db",
		background: "#f9fafb",
		preview: ["#9ca3af", "#6b7280", "#d1d5db", "#f9fafb"],
	},
	{
		id: "dark-gray",
		name: "Dark Gray",
		primary: "#4b5563",
		secondary: "#374151",
		accent: "#6b7280",
		background: "#f3f4f6",
		preview: ["#4b5563", "#374151", "#6b7280", "#f3f4f6"],
	},
];

export const blueColorPalettes = colorPalettes.filter((palette) =>
	palette.name.toLowerCase().includes("blue")
);

export class ColorController {
	constructor() {
		let savedPaletteId = "default-blue";
		let savedDarkMode = false;

		if (typeof window !== "undefined") {
			try {
				savedPaletteId =
					localStorage.getItem("selectedColorPalette") || "default-blue";
				savedDarkMode = localStorage.getItem("darkMode") === "true";
			} catch (e) {
				console.error("Error accessing localStorage:", e);
			}
		}

		this.currentPalette =
			colorPalettes.find((p) => p.id === savedPaletteId) || colorPalettes[1];
		this.isDarkMode = savedDarkMode;
		this.listeners = [];
		this.darkModeListeners = [];
		this.initialized = false;
	}

	getCurrentPalette() {
		return this.currentPalette;
	}

	isDark() {
		return this.isDarkMode;
	}

	setPalette(paletteId) {
		const palette = colorPalettes.find((p) => p.id === paletteId);
		if (palette) {
			this.currentPalette = palette;

			if (typeof window !== "undefined") {
				try {
					localStorage.setItem("selectedColorPalette", paletteId);
				} catch (e) {
					console.error("Error accessing localStorage:", e);
				}
			}

			this.applyCSSVariables(palette);
			this.listeners.forEach((listener) => listener(palette));
		}
	}

	toggleDarkMode() {
		this.isDarkMode = !this.isDarkMode;

		if (typeof window !== "undefined") {
			try {
				localStorage.setItem("darkMode", this.isDarkMode.toString());
			} catch (e) {
				console.error("Error accessing localStorage:", e);
			}
		}

		this.applyDarkMode(this.isDarkMode);
		this.darkModeListeners.forEach((listener) => listener(this.isDarkMode));
	}

	applyDarkMode(isDark) {
		if (typeof window !== "undefined") {
			const root = document.documentElement;
			if (isDark) {
				root.classList.add("dark");
				root.style.setProperty("--color-background", "#0f172a");
				root.style.setProperty("--background", "222.2 84% 4.9%");
				root.style.setProperty("--foreground", "210 40% 98%");
				root.style.setProperty("--card", "222.2 84% 4.9%");
				root.style.setProperty("--card-foreground", "210 40% 98%");
			} else {
				root.classList.remove("dark");
				root.style.setProperty(
					"--color-background",
					this.currentPalette.background
				);
				root.style.setProperty("--background", "0 0% 100%");
				root.style.setProperty("--foreground", "222.2 84% 4.9%");
				root.style.setProperty("--card", "0 0% 100%");
				root.style.setProperty("--card-foreground", "222.2 84% 4.9%");
			}
		}
	}

	applyCSSVariables(palette) {
		if (typeof window !== "undefined") {
			const root = document.documentElement;

			// Apply main color variables
			root.style.setProperty("--color-primary", palette.primary);
			root.style.setProperty("--color-secondary", palette.secondary);
			root.style.setProperty("--color-accent", palette.accent);

			// Only update background if not in dark mode
			if (!this.isDarkMode) {
				root.style.setProperty("--color-background", palette.background);
			}

			// Convert hex to RGB for Tailwind compatibility
			root.style.setProperty(
				"--color-primary-rgb",
				this.hexToRgb(palette.primary)
			);
			root.style.setProperty(
				"--color-secondary-rgb",
				this.hexToRgb(palette.secondary)
			);
			root.style.setProperty(
				"--color-accent-rgb",
				this.hexToRgb(palette.accent)
			);

			// Update Tailwind CSS variables for better integration
			root.style.setProperty("--primary", this.hexToHsl(palette.primary));
			root.style.setProperty("--primary-foreground", "210 40% 98%");

			// Apply custom utility variables
			root.style.setProperty("--primary-custom", palette.primary);
			root.style.setProperty("--secondary-custom", palette.secondary);
			root.style.setProperty("--accent-custom", palette.accent);

			// Update button and component colors
			root.style.setProperty("--primary-button", palette.primary);
			root.style.setProperty("--primary-button-hover", palette.secondary);

			// Update border colors for better integration
			root.style.setProperty("--primary-border", palette.primary);
			root.style.setProperty("--accent-border", palette.accent);

			console.log("Applied color palette:", palette.name, palette);
		}
	}

	hexToRgb(hex) {
		const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
		if (result) {
			const r = Number.parseInt(result[1], 16);
			const g = Number.parseInt(result[2], 16);
			const b = Number.parseInt(result[3], 16);
			return `${r} ${g} ${b}`;
		}
		return "59 130 246";
	}

	hexToHsl(hex) {
		const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
		if (result) {
			const r = Number.parseInt(result[1], 16) / 255;
			const g = Number.parseInt(result[2], 16) / 255;
			const b = Number.parseInt(result[3], 16) / 255;

			const max = Math.max(r, g, b);
			const min = Math.min(r, g, b);
			let h;
			let s;
			const l = (max + min) / 2;

			if (max === min) {
				h = s = 0;
			} else {
				const d = max - min;
				s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
				switch (max) {
					case r:
						h = (g - b) / d + (g < b ? 6 : 0);
						break;
					case g:
						h = (b - r) / d + 2;
						break;
					case b:
						h = (r - g) / d + 4;
						break;
					default:
						h = 0;
				}
				h /= 6;
			}

			return `${Math.round(h * 360)} ${Math.round(s * 100)}% ${Math.round(
				l * 100
			)}%`;
		}
		return "221 83% 53%";
	}

	subscribe(listener) {
		this.listeners.push(listener);
		return () => {
			const index = this.listeners.indexOf(listener);
			if (index > -1) {
				this.listeners.splice(index, 1);
			}
		};
	}

	subscribeDarkMode(listener) {
		this.darkModeListeners.push(listener);
		return () => {
			const index = this.darkModeListeners.indexOf(listener);
			if (index > -1) {
				this.darkModeListeners.splice(index, 1);
			}
		};
	}

	async initialize() {
		if (this.initialized) return;

		if (typeof window !== "undefined") {
			if (document.readyState === "loading") {
				await new Promise((resolve) => {
					document.addEventListener("DOMContentLoaded", resolve);
				});
			}

			this.applyCSSVariables(this.currentPalette);
			this.applyDarkMode(this.isDarkMode);
			this.initialized = true;

			console.log(
				"Color controller initialized with palette:",
				this.currentPalette.name
			);
		}
	}
}

export const colorController = new ColorController();
